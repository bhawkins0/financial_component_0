<h2 class="pageTitle display-4">Financial Component</h2>

<%= form_for :userauthentication, url: "/process_login_form", method: "post" do |f| %>

  <%= f.text_field :query_email, class: "form_textbox form-control", id: "login_email", value:"Email", onblur: "if(this.value == '') { this.value = 'Email'}", onfocus: "if(this.value == 'Email') {this.value = ''};"%>

  <%= f.password_field :query_password, class: "form_textbox form-control", value:"Password", onblur: "if(this.value == '') { this.value = 'Password'; }", onfocus: "if(this.value == 'Password') { this.value = ''};"%>

    <div class="form_prompts">
        <a id=forgot_password_link href="#">Forgot your password?</a>
        &bull;
        <a href="/resend_email">Resend email confirmation</a>
    </div>

  <%= f.submit "Log In", value:"Log In", class: "form_button" %>
  <%= f.submit "Register", value:"Register", class: "form_button" %>
<% end %>

<div class="div_spacing text-success"><%=notice%></div>

<div id="email_verification">
  <%= render partial: "user_authentication/email_verification.html.erb", locals: {email_exists: @email_exists} %>
</div>

<script>
  function validateEmail(email) 
  {
      var re = /\S+@\S+\.\S+/;
      return re.test(email);
  }

  function validate_email(email){
    $.ajax({
              beforeSend: function(xhr) {
                xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'));
              },
              url: "/validate_email",
              type: "POST",
              data: {
                email: email
              }
            });
  };

  $('#forgot_password_link').click(function(){ ;
    const $result = $("#login_alert");
    const email = $("#login_email").val();
    $result.text("");

    if (validateEmail(email)) {
      validate_email(email);
    } else {
      $result.text("Please enter a valid email address.");
    };
    return false; 
  });
</script>